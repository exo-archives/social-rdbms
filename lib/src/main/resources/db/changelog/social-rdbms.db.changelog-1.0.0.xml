<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
    xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
                      http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.4.xsd">

  <!-- Managing both DB that use sequences and db that use auto increment -->
  <property name="autoIncrement" value="true" dbms="mysql,mssql,h2,sybase,db2,hsqldb"/>
  <property name="autoIncrement" value="false" dbms="oracle,postgresql"/>    
    
    <changeSet author="social" id="1.0.0-1">
        <createTable tableName="SOC_ACTIVITIES">
            <column name="ACTIVITY_ID" type="BIGINT" autoIncrement="${autoIncrement}" startWith="1">
              <constraints nullable="false" primaryKey="true" primaryKeyName="PK_SOC_ACTIVITIES"/>
            </column>
            <column name="APP_ID" type="NVARCHAR(36)"/>
            <column name="BODY" type="LONGTEXT"/>
            <column name="BODY_ID" type="NVARCHAR(36)"/>
            <column name="EXTERNAL_ID" type="NVARCHAR(36)"/>
            <column name="PROVIDER_ID" type="NVARCHAR(36)"/>
            <column name="HIDDEN" type="BIT"/>
            <column name="LAST_UPDATED" type="BIGINT"/>
            <column name="LOCKED" type="BIT"/>
            <column name="OWNER_ID" type="NVARCHAR(36)"/>
            <column name="PERMALINK" type="NVARCHAR(255)"/>
            <column name="POSTED" type="BIGINT"/>
            <column name="POSTER_ID" type="NVARCHAR(36)"/>
            <column name="PRIORITY" type="FLOAT(12)">
                <constraints nullable="false"/>
            </column>
            <column name="TITLE" type="LONGTEXT"/>
            <column name="TITLE_ID" type="NVARCHAR(1024)"/>
            <column name="TYPE" type="NVARCHAR(255)"/>
        </createTable>
        <modifySql dbms="mysql">
            <append value=" ENGINE=INNODB CHARSET=UTF8 COLLATE utf8_general_ci"/>
        </modifySql>
    </changeSet>
    <changeSet author="social" id="1.0.0-1.1">
        <createIndex tableName="SOC_ACTIVITIES" indexName="IDX_SOC_ACTIVITIES_01">
            <column name="LAST_UPDATED" descending="true"/>
        </createIndex>
        <createIndex tableName="SOC_ACTIVITIES" indexName="IDX_SOC_ACTIVITIES_02">
            <column name="POSTER_ID"/>
        </createIndex>
        <createIndex tableName="SOC_ACTIVITIES" indexName="IDX_SOC_ACTIVITIES_03">
            <column name="OWNER_ID"/>
        </createIndex>
        <createIndex tableName="SOC_ACTIVITIES" indexName="IDX_SOC_ACTIVITIES_04">
            <column name="HIDDEN"/>
        </createIndex>
    </changeSet>

    <changeSet author="social" id="1.0.0-2">
        <createTable tableName="SOC_ACTIVITY_LIKERS">
            <column name="ACTIVITY_ID" type="BIGINT"> 
                <constraints nullable="false"/>
            </column>
            <column name="LIKER_ID" type="NVARCHAR(36)"/>
        </createTable>
    </changeSet>
    <changeSet author="social" id="1.0.0-3">
        <createTable tableName="SOC_MENTIONS">
            <column name="MENTION_ID" type="BIGINT" autoIncrement="${autoIncrement}" startWith="1">
              <constraints nullable="false" primaryKey="true" primaryKeyName="PK_SOC_MENTIONS"/>
            </column>
            <column name="ACTIVITY_ID" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="MENTIONER_ID" type="NVARCHAR(36)">
                <constraints nullable="false"/>
            </column>
        </createTable>
        <createIndex tableName="SOC_MENTIONS" indexName="IDX_SOC_MENTIONS_01">
            <column name="MENTIONER_ID"/>
        </createIndex>
    </changeSet>
    <changeSet author="social" id="1.0.0-4">
        <createTable tableName="SOC_ACTIVITY_TEMPLATE_PARAMS">
            <column name="ACTIVITY_ID" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="TEMPLATE_PARAM_VALUE" type="NVARCHAR(1024)"/>
            <column name="TEMPLATE_PARAM_KEY" type="NVARCHAR(255)">
                <constraints nullable="false"/>
            </column>
        </createTable>
        <modifySql dbms="mysql">
            <append value=" ENGINE=INNODB CHARSET=UTF8 COLLATE utf8_general_ci"/>
        </modifySql>
    </changeSet>
    <changeSet author="social" id="1.0.0-5">
        <createTable tableName="SOC_COMMENTS">
            <column name="COMMENT_ID" type="BIGINT" autoIncrement="${autoIncrement}" startWith="1">
              <constraints nullable="false" primaryKey="true" primaryKeyName="PK_SOC_COMMENTS"/>
            </column>
            <column name="APP_ID" type="NVARCHAR(36)"/>
            <column name="BODY" type="LONGTEXT"/>
            <column name="BODY_ID" type="NVARCHAR(36)"/>
            <column name="EXTERNAL_ID" type="NVARCHAR(36)"/>
            <column name="HIDDEN" type="BIT"/>
            <column name="LAST_UPDATED" type="BIGINT"/>
            <column name="LOCKED" type="BIT"/>
            <column name="OWNER_ID" type="NVARCHAR(36)"/>
            <column name="PERMALINK" type="NVARCHAR(255)"/>
            <column name="POSTED" type="BIGINT"/>
            <column name="POSTER_ID" type="NVARCHAR(36)"/>
            <column name="PRIORITY" type="FLOAT(12)">
                <constraints nullable="false"/>
            </column>
            <column name="TITLE" type="LONGTEXT"/>
            <column name="TITLE_ID" type="NVARCHAR(1024)"/>
            <column name="TYPE" type="NVARCHAR(255)"/>
            <column name="ACTIVITY_ID" type="BIGINT"/>
        </createTable>
        <modifySql dbms="mysql">
            <append value=" ENGINE=INNODB CHARSET=UTF8 COLLATE utf8_general_ci"/>
        </modifySql>
    </changeSet>
    <changeSet author="social" id="1.0.0-5.1">
        <createIndex tableName="SOC_COMMENTS" indexName="IDX_SOC_COMMENTS_01">
            <column name="LAST_UPDATED" descending="true"/>
        </createIndex>
        <createIndex tableName="SOC_COMMENTS" indexName="IDX_SOC_COMMENTS_02">
            <column name="POSTER_ID"/>
        </createIndex>
    </changeSet>

    <changeSet author="social" id="1.0.0-6">
        <createTable tableName="SOC_COMMENT_TEMPLATE_PARAMS">
            <column name="COMMENT_ID" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="TEMPLATE_PARAM_VALUE" type="NVARCHAR(1024)"/>
            <column name="TEMPLATE_PARAM_KEY" type="NVARCHAR(255)">
                <constraints nullable="false"/>
            </column>
        </createTable>
        <modifySql dbms="mysql">
            <append value=" ENGINE=INNODB CHARSET=UTF8 COLLATE utf8_general_ci"/>
        </modifySql>
    </changeSet>
    <changeSet author="social" id="1.0.0-7">
        <createTable tableName="SOC_CONNECTIONS">
            <column name="CONNECTION_ID" type="BIGINT" autoIncrement="${autoIncrement}" startWith="1">
              <constraints nullable="false" primaryKey="true" primaryKeyName="PK_SOC_CONNECTIONS"/>
            </column>
            <column name="RECEIVER_ID" type="NVARCHAR(36)"/>
            <column name="SENDER_ID" type="NVARCHAR(36)"/>
            <column name="STATUS" type="INT"/>
            <column name="PROFILE_ID" type="BIGINT"/>
            <column name="LAST_UPDATED" type="BIGINT"/>
        </createTable>
        <createIndex tableName="SOC_CONNECTIONS" indexName="IDX_SOC_CONNECTIONS_01">
            <column name="RECEIVER_ID"/>
        </createIndex>
        <createIndex tableName="SOC_CONNECTIONS" indexName="IDX_SOC_CONNECTIONS_02">
            <column name="SENDER_ID"/>
        </createIndex>
        <createIndex tableName="SOC_CONNECTIONS" indexName="IDX_SOC_CONNECTIONS_03">
            <column name="LAST_UPDATED" descending="true"/>
        </createIndex>
        <createIndex tableName="SOC_CONNECTIONS" indexName="IDX_SOC_CONNECTIONS_04">
            <column name="STATUS"/>
        </createIndex>
    </changeSet>
    <changeSet author="social" id="1.0.0-8">
        <createTable tableName="SOC_STREAM_ITEMS">
            <column name="STREAM_ITEM_ID" type="BIGINT" autoIncrement="${autoIncrement}" startWith="1">
              <constraints nullable="false" primaryKey="true" primaryKeyName="PK_SOC_STREAM_ITEMS"/>
            </column>
            <column name="OWNER_ID" type="NVARCHAR(36)"/>
            <column name="STREAM_TYPE" type="INT"/>
            <column name="ACTIVITY_ID" type="BIGINT"/>
            <column name="LAST_UPDATED" type="BIGINT"/>
        </createTable>
    </changeSet>
    <changeSet author="social" id="1.0.0-8.1">
        <createIndex tableName="SOC_STREAM_ITEMS" indexName="IDX_SOC_STREAM_ITEMS_01">
            <column name="LAST_UPDATED" descending="true"/>
        </createIndex>
        <createIndex tableName="SOC_STREAM_ITEMS" indexName="IDX_SOC_STREAM_ITEMS_02">
            <column name="STREAM_TYPE"/>
        </createIndex>
    </changeSet>
    <changeSet author="social" id="1.0.0-9">
        <addPrimaryKey columnNames="ACTIVITY_ID, TEMPLATE_PARAM_KEY" constraintName="PK_SOC_ACT_TEMPLATE_PARAMS_01" tableName="SOC_ACTIVITY_TEMPLATE_PARAMS"/>
    </changeSet>
    <changeSet author="social" id="1.0.0-10">
        <addPrimaryKey columnNames="COMMENT_ID, TEMPLATE_PARAM_KEY" constraintName="PK_SOC_CMT_TEMPLATE_PARAMS_01" tableName="SOC_COMMENT_TEMPLATE_PARAMS"/>
    </changeSet>
    <changeSet author="social" id="1.0.0-11">
        <addForeignKeyConstraint baseColumnNames="ACTIVITY_ID" baseTableName="SOC_ACTIVITY_LIKERS" constraintName="FK_SOC_ACT_LIKERS_ACT_01" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="ACTIVITY_ID" referencedTableName="SOC_ACTIVITIES"/>
    </changeSet>
    <changeSet author="social" id="1.0.0-12">
        <addForeignKeyConstraint baseColumnNames="ACTIVITY_ID" baseTableName="SOC_MENTIONS" constraintName="FK_SOC_MENTIONS_ACT_01" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="ACTIVITY_ID" referencedTableName="SOC_ACTIVITIES"/>
    </changeSet>
    <changeSet author="social" id="1.0.0-13">
        <addForeignKeyConstraint baseColumnNames="ACTIVITY_ID" baseTableName="SOC_COMMENTS" constraintName="FK_SOC_CMT_ACT_01" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="ACTIVITY_ID" referencedTableName="SOC_ACTIVITIES"/>
    </changeSet>
    <changeSet author="social" id="1.0.0-14">
        <addForeignKeyConstraint baseColumnNames="ACTIVITY_ID" baseTableName="SOC_ACTIVITY_TEMPLATE_PARAMS" constraintName="FK_SOC_ACT_TEMP_PAR_ACT_01" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="ACTIVITY_ID" referencedTableName="SOC_ACTIVITIES"/>
    </changeSet>
    <changeSet author="social" id="1.0.0-15">
        <addForeignKeyConstraint baseColumnNames="COMMENT_ID" baseTableName="SOC_COMMENT_TEMPLATE_PARAMS" constraintName="FK_SOC_CMT_TEMP_PAR_CMT_01" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="COMMENT_ID" referencedTableName="SOC_COMMENTS"/>
    </changeSet>
    <changeSet author="social" id="1.0.0-16">
		    <addUniqueConstraint columnNames="SENDER_ID, RECEIVER_ID"
		            constraintName="UK_SENDER_ID_RECEIVER_ID_01"
		            tableName="SOC_CONNECTIONS"/>
	</changeSet>
    <changeSet author="social" id="1.0.0-17">
        <addForeignKeyConstraint baseColumnNames="ACTIVITY_ID" baseTableName="SOC_STREAM_ITEMS" constraintName="FK_SOC_STREAM_ITEMS_ACT_01" deferrable="false" initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="ACTIVITY_ID" referencedTableName="SOC_ACTIVITIES"/>
    </changeSet>
  <!-- defines PK -->
  <changeSet author="social" id="1.0.0-18" dbms="oracle,postgresql">
    <createSequence sequenceName="SEQ_SOC_ACTIVITIES_ID" startValue="1"/>
  </changeSet>
  <changeSet author="social" id="1.0.0-19" dbms="oracle,postgresql">
    <createSequence sequenceName="SEQ_SOC_MENTIONS_ID" startValue="1"/>
  </changeSet>
  <changeSet author="social" id="1.0.0-20" dbms="oracle,postgresql">
    <createSequence sequenceName="SEQ_SOC_COMMENTS_ID" startValue="1"/>
  </changeSet>
  <changeSet author="social" id="1.0.0-21" dbms="oracle,postgresql">
    <createSequence sequenceName="SEQ_SOC_CONNECTIONS_ID" startValue="1"/>
  </changeSet>
  <changeSet author="social" id="1.0.0-22" dbms="oracle,postgresql">
    <createSequence sequenceName="SEQ_SOC_STREAM_ITEMS_ID" startValue="1"/>
  </changeSet>
  
  <changeSet author="social" id="1.0.0-23">
    <createTable tableName="SOC_SPACES">
        <column name="SPACE_ID" type="BIGINT" autoIncrement="${autoIncrement}" startWith="1">
          <constraints nullable="false" primaryKey="true" primaryKeyName="PK_SOC_SPACES"/>
        </column>
        <column name="APP" type="LONGTEXT"/>
        <column name="PRETTY_NAME" type="NVARCHAR(200)"/>
        <column name="DISPLAY_NAME" type="NVARCHAR(200)"/>
        <column name="REGISTRATION" type="TINYINT"/>
        <column name="DESCRIPTION" type="LONGTEXT"/>
        <column name="AVATAR_LAST_UPDATED" type="BIGINT"/>
        <column name="VISIBILITY" type="TINYINT"/>
        <column name="PRIORITY" type="TINYINT"/>
        <column name="GROUP_ID" type="NVARCHAR(200)"/>
        <column name="URL" type="NVARCHAR(500)"/>
        <column name="CREATED_TIME" type="BIGINT"/>
    </createTable>
    <modifySql dbms="mysql">
        <append value=" ENGINE=INNODB CHARSET=UTF8 COLLATE utf8_general_ci"/>
    </modifySql>
  </changeSet>
  <changeSet author="social" id="1.0.0-24">
    <createTable tableName="SOC_APPS">
        <column name="SPACE_ID" type="BIGINT">
          <constraints foreignKeyName="FK_SOC_APP_SPACE_01" references="SOC_SPACES(SPACE_ID)" nullable="false"/>
        </column>
        <column name="APP_ID" type="NVARCHAR(200)"/>
        <column name="APP_NAME" type="NVARCHAR(200)"/>
        <column name="REMOVABLE" type="BIT"/>
        <column name="STATUS" type="TINYINT"/>
    </createTable>
    <modifySql dbms="mysql">
        <append value=" ENGINE=INNODB CHARSET=UTF8 COLLATE utf8_general_ci"/>
    </modifySql>
  </changeSet>
  <changeSet author="social" id="1.0.0-25">
    <createTable tableName="SOC_SPACES_MEMBERS">
      <column name="SPACE_MEMBER_ID" type="BIGINT" autoIncrement="${autoIncrement}" startWith="1">
        <constraints nullable="false" primaryKey="true" primaryKeyName="PK_SOC_SPACES_MEMBERS"/>
      </column>
      <column name="SPACE_ID" type="BIGINT">
        <constraints foreignKeyName="FK_SOC_MEM_SPACE_01" references="SOC_SPACES(SPACE_ID)" nullable="false"/>
      </column>
      <column name="USER_ID" type="NVARCHAR(36)" />
      <column name="STATUS" type="NVARCHAR(36)" />
      <column name="LAST_ACCESS" type="BIGINT"/>
      <column name="VISITED" type="BIT"/>
    </createTable>
    <modifySql dbms="mysql">
      <append value=" ENGINE=INNODB CHARSET=UTF8 COLLATE utf8_general_ci"/>
    </modifySql>    
  </changeSet>

  <changeSet author="social" id="1.0.0-26">
    <createTable tableName="SOC_IDENTITY">
      <column name="IDENTITY_ID" type="BIGINT" autoIncrement="${autoIncrement}" startWith="1">
        <constraints nullable="false" primaryKey="true" primaryKeyName="PK_SOC_IDENTITIES"/>
      </column>
      <column name="PROVIDER_ID" type="NVARCHAR(50)"/>
      <column name="REMOTE_ID" type="NVARCHAR(100)"/>
      <column name="ENABLE"  type="BIT" defaultValue="1"/>
      <column name="DELETED" type="BIT" defaultValue="0"/>
    </createTable>
    <modifySql dbms="mysql">
      <append value=" ENGINE=INNODB CHARSET=UTF8 COLLATE utf8_general_ci"/>
    </modifySql>
  </changeSet>
  <changeSet author="social" id="1.0.0-27">
    <addUniqueConstraint columnNames="PROVIDER_ID, REMOTE_ID"
                         constraintName="UK_PROVIDER_ID_REMOTE_ID_01"
                         tableName="SOC_IDENTITY"/>
  </changeSet>
  <changeSet author="social" id="1.0.0-28" dbms="oracle,postgresql">
    <createSequence sequenceName="SEQ_SOC_IDENTITY_ID" startValue="1"/>
  </changeSet>

  <changeSet author="social" id="1.0.0-29">
    <createTable tableName="SOC_IDENTITY_PROFILE">
      <column name="PROFILE_ID" type="BIGINT" autoIncrement="${autoIncrement}" startWith="1">
        <constraints nullable="false" primaryKey="true" primaryKeyName="PK_SOC_IDENTITY_PROFILE"/>
      </column>
      <column name="IDENTITY_ID" type="BIGINT">
        <constraints foreignKeyName="FK_SOC_IDENTITY_PROFILE" references="SOC_IDENTITY(IDENTITY_ID)" nullable="false"/>
      </column>
      <column name="URL" type="NVARCHAR(250)"/>
      <column name="AVATAR_URL" type="NVARCHAR(250)"/>
      <column name="AVATAR_MIMTYPE" type="NVARCHAR(250)"/>
      <column name="AVATAR_IMAGE" type="BLOB"/>
      <column name="CREATED_TIME" type="TIMESTAMP"/>
    </createTable>
    <modifySql dbms="mysql">
      <append value=" ENGINE=INNODB CHARSET=UTF8 COLLATE utf8_general_ci"/>
    </modifySql>
  </changeSet>
  <changeSet author="social" id="1.0.0-30">
    <addUniqueConstraint columnNames="IDENTITY_ID"
                         constraintName="UK_IDENTITY_PROFILE_IDENTITY_ID_01"
                         tableName="SOC_IDENTITY_PROFILE"/>
  </changeSet>
  <changeSet author="social" id="1.0.0-30" dbms="oracle,postgresql">
    <createSequence sequenceName="SEQ_SOC_IDENTITY_PROFILE_ID" startValue="1"/>
  </changeSet>

  <changeSet author="social" id="1.0.0-31">
    <createTable tableName="SOC_IDENTITY_PROFILE_PROPERTY">
      <column name="PROFILE_ID" type="BIGINT">
        <constraints foreignKeyName="FK_SOC_IDENTITY_PROFILE_PROPERTY" references="SOC_IDENTITY_PROFILE(PROFILE_ID)" nullable="false"/>
      </column>
      <column name="NAME" type="NVARCHAR(250)"/>
      <column name="VALUE" type="NVARCHAR(500)"/>
    </createTable>
    <modifySql dbms="mysql">
      <append value=" ENGINE=INNODB CHARSET=UTF8 COLLATE utf8_general_ci"/>
    </modifySql>
  </changeSet>

  <changeSet author="social" id="1.0.0-32">
    <createTable tableName="SOC_IDENTITY_PROFILE_EXPERIENCE">
      <column name="PROFILE_ID" type="BIGINT">
        <constraints foreignKeyName="FK_SOC_IDENTITY_PROFILE_EXPERIENCE" references="SOC_IDENTITY_PROFILE(PROFILE_ID)" nullable="false"/>
      </column>
      <column name="COMPANY" type="NVARCHAR(250)"/>
      <column name="POSITION" type="NVARCHAR(250)"/>
      <column name="START_DATE" type="NCHAR(10)"/>
      <column name="END_DATE" type="NCHAR(10)"/>
      <column name="SKILLS" type="NVARCHAR(500)"/>
      <column name="DESCRIPTION" type="NVARCHAR(500)"/>
    </createTable>
    <modifySql dbms="mysql">
      <append value=" ENGINE=INNODB CHARSET=UTF8 COLLATE utf8_general_ci"/>
    </modifySql>
  </changeSet>

  <changeSet author="social" id="1.0.0-33">
    <modifyDataType tableName="SOC_SPACES_MEMBERS"
                    columnName="USER_ID"
                    newDataType="NVARCHAR(100)"/>
  </changeSet>

  <changeSet author="social" id="1.0.0-34">
    <modifyDataType tableName="SOC_IDENTITY_PROFILE_EXPERIENCE"
                    columnName="DESCRIPTION"
                    newDataType="LONGTEXT"/>
  </changeSet>

</databaseChangeLog>
